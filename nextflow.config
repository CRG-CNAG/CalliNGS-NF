params.gatk = "$PWD/GenomeAnalysisTK.jar"

docker.enabled = true
docker.runOptions = "-v ${params.gatk}:${params.gatk}"
process.container = "cbcrg/callings-nf@sha256:26e79043e9756e2e4c8e3fb71731eaac9de362b165f4d9f078d86d9afa88414b"

profiles {
  
    circleci {
     	docker.enabled = true
        docker.runOptions = ""
        process.container = "885800555707.dkr.ecr.us-east-1.amazonaws.com/cbcrg/callings-with-gatk:latest"
        params.gatk = '/opt/broad/GenomeAnalysisTK.jar'
    }

    aws {
         params {
            genome     = "s3://cbcrg-eu/callings-data/genome.fa"
            reads      = "s3://cbcrg-eu/callings-data/reads/rep*_{1,2}.fq.gz"
            variants   = "s3://cbcrg-eu/callings-data/known_variants.vcf.gz"
            blacklist  = "s3://cbcrg-eu/callings-data/blacklist.bed"         
            results    = "s3://cbcrg-eu/callings-results"
         }
    }

    cluster {
        params {
            genome    = "$baseDir/data/genome.fa"
            reads     = "$baseDir/data/reads/rep*_{1,2}.fq.gz"
            bams      = "$baseDir/data/bams/rep*.bam"
            variants  = "$baseDir/data/known_variants.vcf.gz"
            blacklist = "$baseDir/data/blacklist.bed"
        }

        process {
            executor = 'crg'
            penv = 'smp'
            queue = 'cn-el7,short-sl7'
            memory = 16.GB
            errorStrategy = 'finish'
            scratch=true

            $1B_prepare_genome_picard {
                memory = 64.GB
            }

            $1C_prepare_star_genome_index {
                cpus = 2
                memory = 16.GB
            }

            $2_rnaseq_mapping_star {
                cpus = 2
                memory = 16.GB
            }

            $3_rnaseq_gatk_splitNcigar {
                memory = 48.GB
            }

            $4_rnaseq_gatk_recalibrate {
                memory = 48.GB
            }

            $5_rnaseq_call_variants {
                memory = 48.GB
            }

            $6C_ASE_knownSNPs {
                memory = 48.GB
            }
        }

    }
}

